(function($){$.selekt={count:0};function createSelektHTML(selekt){var selectId=selekt.$sourceSelect.attr("id");var value=$("option:selected",selekt.$sourceSelect).val();var $selekt=$("<div class='selekt selekt-el' id='"+selectId+"-selekt' data-value='"+value+"'/>");$selekt.css("z-index",99).append($("option:selected",selekt.$sourceSelect).text()).prop("tabindex",selekt.$sourceSelect.prop("tabindex")).data("selekt",selekt);var $selektRollout=$("<div class='selekt-rollout selekt-el' style='display: none;overflow: auto;' id='"+selectId+"-selekt-rollout'>");$selektRollout.append("<ul></ul>");$("option",selekt.$sourceSelect).each(function(index){var $el=$(this);var selected=$el.is(":selected")?"hover selected ":"";value=$el.val()!=""?$el.val():$el.text();$li=$("<li class='"+selected+"selekt-option selekt-el' id='"+selectId+"-selekt-option-"+index+"' data-value='"+value+"'>"+$el.text()+"</li>");$("ul",$selektRollout).append($li);$li.data("index",index)});$selektWrap=$("<div class='selekt-el selekt-wrap' style='position: relative; overflow: visible; display: inline-block' id='"+selectId+"-selekt-wrap'/>").append($selekt).append($selektRollout);selekt.$sourceSelect.before($selektWrap).hide();$selektRollout.css({position:"absolute",left:"0px",top:$selekt.outerHeight()+"px",zIndex:100});$selektRollout.children("ul").css("position","relative");return{$selekt:$selekt,$rollout:$selektRollout}}function attachEventsToSelekt(selekt){selekt.shouldBlur=false;selekt.$self.click(function(){if(selekt.$rollout.is(":hidden")){selekt.rollDown()}else{selekt.rollUp()}}).keypress(function(ev){var charCode=ev.charCode===undefined?ev.keyCode:ev.charCode;if(charCode&&(ev.keyCode==0||ev.keyCode>=48&&ev.keyCode<=90||ev.keyCode>=97&&ev.keyCode<=172)){selekt.jumpByLetter(String.fromCharCode(charCode));ev.preventDefault()}}).keydown(function(ev){switch(ev.keyCode){case 13:if(selekt.$self.is(".rollout")){selekt.rollUp()}selekt.pushChangeIfDifferent();ev.preventDefault();break;case 38:selekt.keyArrowUp();ev.preventDefault();break;case 40:selekt.keyArrowDown();ev.preventDefault();break}}).blur(function(){var scrollTop=selekt.$rollout.scrollTop()+selekt.$rollout_ul.scrollTop();if(scrollTop==selekt.$rollout.scrollTop()+selekt.$rollout_ul.scrollTop()){if(selekt.$rollout.is(":hidden")){selekt.pushChangeIfDifferent()}else{selekt.rollUpTimeout=setTimeout(function(sel){sel.rollUpAndFocus()},250,selekt)}selekt.shouldBlur=true}else{selekt.$self.focus()}});$("ul li",selekt.$rollout).click(function(ev){var selekt=$(this).parent().parent().prev().data("selekt");if(selekt.rollUpTimeout){clearTimeout(selekt.rollUpTimeout);selekt.rollUpTimeout=null}$this=$(this);$this.addClass("selected").siblings(".selected").removeClass("selected");selekt.change($this.data("index"));selekt.pushChangeIfDifferent();selekt.rollUpAndFocus()}).mouseover(function(){$("li.hover",selekt.$rollout).removeClass("hover");$(this).addClass("hover")})}function Selekt($select){this.$sourceSelect=$select;this.selectedIndex=$select.prop("selectedIndex");this.maxIndex=$("option",$select).length-1;this.searchPattern={prefix:"",timestamp:0};this.rollUpTimeout=null;var result=createSelektHTML(this);this.$self=result.$selekt;this.$rollout=result.$rollout;this.$rollout_ul=result.$rollout.children("ul");attachEventsToSelekt(this);this.rollDown=function(){var height=this.$rollout.outerHeight(),offset=this.$self.offset().top+this.$self.outerHeight();if(height+offset<$(window).height()){this.$rollout.slideDown("fast")}else{this.$rollout.addClass("selekt-rollout-up");this.$rollout.css({top:null,bottom:0});this.$rollout.show()}offset=this.$rollout.offset();this.$self.addClass("rollout");this.$rollout.scrollTop($("li.selected",this.$rollout).position().top)};this.rollUp=function(){$("li.hover",this.$rollout).removeClass("hover");$("li.selected",this.$rollout).addClass("hover");if(this.$rollout.is(".selekt-rollout-up")){this.$rollout.hide().removeClass("selekt-rollout-up").css({bottom:null,top:0})}else{this.$rollout.slideUp("fast")}this.$self.removeClass("rollout");$.selekt.last=null};this.rollUpAndFocus=function(){this.rollUp();this.$self.focus()};this.keyArrowUp=function(){if(this.$rollout.is(":not(:hidden)")&&$("li.hover:not(.selected)",this.$rollout).length){this.selectedIndex=$("li.hover:not(.selected)",this.$rollout).data("index")}this.change(this.selectedIndex-1);this.showSelectedUp()};this.keyArrowDown=function(){if(this.$rollout.is(":not(:hidden)")&&$("li.hover:not(.selected)",this.$rollout).length){this.selectedIndex=$("li.hover:not(.selected)",this.$rollout).data("index")}this.change(this.selectedIndex+1);this.showSelectedDown()};this.change=function(index){if(index<0||index>this.maxIndex){return}this.selectedIndex=index;$li=this.$rollout.children().children().eq(index);$li.addClass("hover").siblings(".hover").removeClass("hover");$li.addClass("selected").siblings(".selected").removeClass("selected");this.$self.html($li.html()).data("value",$li.data("value"))};this.pushChange=function(){this.$sourceSelect.prop("selectedIndex",this.selectedIndex).change()};this.pushChangeIfDifferent=function(){if(this.$sourceSelect.prop("selectedIndex")!=this.selectedIndex){this.$sourceSelect.prop("selectedIndex",this.selectedIndex).change()}};this.jumpByLetter=function(letter){var prefix=this.searchPattern.prefix;var currentTime=(new Date).getTime();if(currentTime-this.searchPattern.timestamp<250){prefix=prefix+letter}else{prefix=letter}this.searchPattern.timestamp=currentTime;this.searchPattern.prefix=prefix;var options=this.$sourceSelect.get(0).options;var patt=new RegExp("^"+prefix,"i");for(var i=this.selectedIndex+1;i<options.length;++i){if(patt.test(options[i].text)){this.change(i);this.showSelectedDown();return}}for(var i=0;i<this.selectedIndex;++i){if(patt.test(options[i].text)){this.change(i);this.showSelectedUp();return}}};this.showSelectedUp=function(){if(this.$rollout.is(":not(:hidden)")){var liTop=$("li.selected",this.$rollout).position().top;if(liTop<this.$rollout.scrollTop()){this.$rollout.scrollTop(liTop)}}};this.showSelectedDown=function(){if(this.$rollout.is(":not(:hidden)")){var $li=$("li.selected",this.$rollout);var liTop=$li.position().top+$li.outerHeight();if(liTop>this.$rollout.scrollTop()+this.$rollout.height()){this.$rollout.scrollTop(liTop-this.$rollout.height())}}}}$.fn.selekt=function(){return $(this).each(function(){var $el=$(this);if(this.id==""){this.id="selekt-select-"+$.selekt.count++}var elId=this.id;if($el.is("select")){if(!$el.prop("tabindex")){$el.prop("tabindex",0)}new Selekt($el)}})}})(jQuery);