(function(d){d.selekt={count:0,};function b(g){var f=g.$sourceSelect.attr("id");var h=d("option:selected",g.$sourceSelect).val();var i=d("<div class='selekt selekt-el' id='"+f+"-selekt' data-value='"+h+"'/>");i.css("z-index",99).append(d("option:selected",g.$sourceSelect).text()).prop("tabindex",g.$sourceSelect.prop("tabindex")).data("selekt",g);var e=d("<div class='selekt-rollout selekt-el' style='display: none;overflow: auto;' id='"+f+"-selekt-rollout'>");e.append("<ul></ul>");d("option",g.$sourceSelect).each(function(j){var k=d(this);var l=k.is(":selected")?"hover selected ":"";h=k.val()!=""?k.val():k.text();$li=d("<li class='"+l+"selekt-option selekt-el' id='"+f+"-selekt-option-"+j+"' data-value='"+h+"'>"+k.text()+"</li>");d("ul",e).append($li);$li.data("index",j)});$selektWrap=d("<div class='selekt-el selekt-wrap' style='position: relative; overflow: visible; display: inline-block' id='"+f+"-selekt-wrap'/>").append(i).append(e);g.$sourceSelect.before($selektWrap).hide();e.css({position:"absolute",left:"0px",top:i.outerHeight()+"px",zIndex:100});e.children("ul").css("position","relative");return{$selekt:i,$rollout:e}}function a(e){e.shouldBlur=false;e.$self.click(function(){if(e.$rollout.is(":hidden")){e.rollDown()}else{e.rollUp()}}).keypress(function(g){var f=g.charCode===undefined?g.keyCode:g.charCode;if(f&&(g.keyCode==0||(g.keyCode>=48&&g.keyCode<=90)||(g.keyCode>=97&&g.keyCode<=172))){e.jumpByLetter(String.fromCharCode(f));g.preventDefault()}}).keydown(function(f){switch(f.keyCode){case 13:if(e.$self.is(".rollout")){e.rollUp()}e.pushChangeIfDifferent();f.preventDefault();break;case 38:e.keyArrowUp();f.preventDefault();break;case 40:e.keyArrowDown();f.preventDefault();break}}).blur(function(){var f=e.$rollout.scrollTop()+e.$rollout_ul.scrollTop();setTimeout(function(){if(f==e.$rollout.scrollTop()+e.$rollout_ul.scrollTop()){if(e.$rollout.is(":hidden")){e.pushChangeIfDifferent()}else{e.rollUpTimeout=setTimeout(function(g){g.rollUpAndFocus()},250,e)}e.shouldBlur=true}else{e.$self.focus()}},200)});d("ul li",e.$rollout).click(function(g){var f=d(this).parent().parent().prev().data("selekt");if(f.rollUpTimeout){clearTimeout(f.rollUpTimeout);f.rollUpTimeout=null}$this=d(this);$this.addClass("selected").siblings(".selected").removeClass("selected");f.change($this.data("index"));f.pushChangeIfDifferent();f.rollUpAndFocus()}).mouseover(function(){d("li.hover",e.$rollout).removeClass("hover");d(this).addClass("hover")})}function c(f){this.$sourceSelect=f;this.selectedIndex=f.prop("selectedIndex");this.maxIndex=d("option",f).length-1;this.searchPattern={prefix:"",timestamp:0};this.rollUpTimeout=null;var e=b(this);this.$self=e.$selekt;this.$rollout=e.$rollout;this.$rollout_ul=e.$rollout.children("ul");a(this);this.rollDown=function(){this.$rollout.slideDown("fast");this.$self.addClass("rollout");this.$rollout.scrollTop(d("li.selected",this.$rollout).position().top)};this.rollUp=function(){d("li.hover",this.$rollout).removeClass("hover");d("li.selected",this.$rollout).addClass("hover");this.$rollout.slideUp("fast");this.$self.removeClass("rollout");d.selekt.last=null};this.rollUpAndFocus=function(){this.rollUp();this.$self.focus()};this.keyArrowUp=function(){if(this.$rollout.is(":not(:hidden)")&&d("li.hover:not(.selected)",this.$rollout).length){this.selectedIndex=d("li.hover:not(.selected)",this.$rollout).data("index")}this.change(this.selectedIndex-1);this.showSelectedUp()};this.keyArrowDown=function(){if(this.$rollout.is(":not(:hidden)")&&d("li.hover:not(.selected)",this.$rollout).length){this.selectedIndex=d("li.hover:not(.selected)",this.$rollout).data("index")}this.change(this.selectedIndex+1);this.showSelectedDown()};this.change=function(g){if(g<0||g>this.maxIndex){return}this.selectedIndex=g;$li=this.$rollout.children().children().eq(g);$li.addClass("hover").siblings(".hover").removeClass("hover");$li.addClass("selected").siblings(".selected").removeClass("selected");this.$self.html($li.html()).data("value",$li.data("value"))};this.pushChange=function(){this.$sourceSelect.prop("selectedIndex",this.selectedIndex).change()};this.pushChangeIfDifferent=function(){if(this.$sourceSelect.prop("selectedIndex")!=this.selectedIndex){this.$sourceSelect.prop("selectedIndex",this.selectedIndex).change()}};this.jumpByLetter=function(k){var m=this.searchPattern.prefix;var j=(new Date).getTime();if(j-this.searchPattern.timestamp<250){m=m+k}else{m=k}this.searchPattern.timestamp=j;this.searchPattern.prefix=m;var g=this.$sourceSelect.get(0).options;var l=new RegExp("^"+m,"i");for(var h=this.selectedIndex+1;h<g.length;++h){if(l.test(g[h].text)){this.change(h);this.showSelectedDown();return}}for(var h=0;h<this.selectedIndex;++h){if(l.test(g[h].text)){this.change(h);this.showSelectedUp();return}}};this.showSelectedUp=function(){if(this.$rollout.is(":not(:hidden)")){var g=d("li.selected",this.$rollout).position().top;if(g<this.$rollout.scrollTop()){this.$rollout.scrollTop(g)}}};this.showSelectedDown=function(){if(this.$rollout.is(":not(:hidden)")){var h=d("li.selected",this.$rollout);var g=h.position().top+h.outerHeight();if(g>this.$rollout.scrollTop()+this.$rollout.height()){this.$rollout.scrollTop(g-this.$rollout.height())}}}}d.fn.selekt=function(){return d(this).each(function(){var f=d(this);if(this.id==""){this.id="selekt-select-"+d.selekt.count++}var e=this.id;if(f.is("select")){if(!f.prop("tabindex")){f.prop("tabindex",0)}new c(f)}})}})(jQuery);